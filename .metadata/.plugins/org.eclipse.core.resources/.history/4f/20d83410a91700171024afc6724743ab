import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import java.util.Random;
public class MesaResource {

 private Connection connection;
	
 public MesaResource(Connection connection){
	 
	 this.connection=connection;
 }
	
 
 
	
 public String getKPI(String parameter1, String parameter2) throws SQLException{
	    
    	Statement stmt = null;
    	String jsonInString="";
    	stmt = this.connection.createStatement();
    	Gson gson = new GsonBuilder().create();
    	
    	Random randomGenerator = new Random();
        int randomInt = randomGenerator.nextInt(10000);
        
    	ResultSet rs = stmt.executeQuery( "SELECT DISTINCT dim2.expected_result_cnt,dim2.validation_rule_comment,dim2.quality_metric_type_name,f.fact_row_no,dim1.service_main_group_name,f.fact_col_no,dim2.expected_result_amt,f.measure_amt,dim1.service_domain_name, dim2.since201702_metric_cnt, dim2.expected_result_cnt,dim1.service_domain_name,f.measure_fact_date FROM mesa.PL_MEASURE_FACT_PRT f INNER JOIN mesa.PL_SERVICE_PRT dim1 ON (f.validation_service_shortname = dim1.Service_Component_ShortName) INNER JOIN mesa.PL_VALIDATION_RULE_EXT dim2 ON (f.Validation_Rule_Id = dim2.Validation_Rule_Id) WHERE f.country_shortname='EE' AND dim2.quality_metric_categ_shortname='DQKPI' AND f.fact_row_no='10' AND f.fact_col_no='7' ;" );
    	while(rs.next()) {
    	  //int numColumns = rs.getColumnCount();
    
    	 // for (int i=1; i<=numColumns; i++) {
    	   // String column_name = rsmd.getColumnName(i);
    	  
    		Format_conformacy model=new Format_conformacy();
    		model.setKPI(rs.getInt("measure_amt"));
    		model.setServiceName(rs.getString("service_main_group_name"));
    		model.setValidationRule(rs.getString"validation_rule_comment"));
    		//String  name = rs.getString("measure_text");
    		//System.out.println(name);
    	  
    	    jsonInString = gson.toJson(model);
    	 // }

    	}
    	
        rs.close();
        stmt.close();
        System.out.println(jsonInString);
        return jsonInString;
    	
    }
}
 /*public String getAccuraccy(String parameter1, String parameter2) throws SQLException{
	    
 	Statement stmt = null;
 	String jsonInString="";
 	stmt = this.connection.createStatement();
 	Gson gson = new GsonBuilder().create();
 	ResultSet rs = stmt.executeQuery( "SELECT * FROM mesa.PL_MEASURE_FACT_PRT LIMIT 1 OFFSET 100;" );
 	while(rs.next()) {
 	  //int numColumns = rs.getColumnCount();
 
 	 // for (int i=1; i<=numColumns; i++) {
 	   // String column_name = rsmd.getColumnName(i);
 	  
 		Format_conformacy model=new Format_conformacy();
 		model.setCompletness(rs.getInt("measure_text"));
 		//String  name = rs.getString("measure_text");
 		//System.out.println(name);
 	  
 	    jsonInString = gson.toJson(model);
 	 // }

 	}
 	
     rs.close();
     stmt.close();
     System.out.println(jsonInString);
     return jsonInString;
 	
 }
 
 public String getCountryCodes(String parameter1, String parameter2) throws SQLException{
	    
	 	Statement stmt = null;
	 	String jsonInString="";
	 	stmt = this.connection.createStatement();
	 	Gson gson = new GsonBuilder().create();
	 	ResultSet rs = stmt.executeQuery("SELECT DISTINCT run_country_shortname FROM mesa.PL_MEASURE_FACT_PRT;" );
	 	while(rs.next()) {
	 	  //int numColumns = rs.getColumnCount();
	 
	 	 // for (int i=1; i<=numColumns; i++) {
	 	   // String column_name = rsmd.getColumnName(i);
	 	  
	 		Format_conformacy model=new Format_conformacy();
	 		model.setCompletness(rs.getInt("measure_text"));
	 		//String  name = rs.getString("measure_text");
	 		//System.out.println(name);
	 	  
	 	    jsonInString = gson.toJson(model);
	 	 // }

	 	}
	 	
	     rs.close();
	     stmt.close();
	     System.out.println(jsonInString);
	     return jsonInString;
	 	
	 }
	
}*/
